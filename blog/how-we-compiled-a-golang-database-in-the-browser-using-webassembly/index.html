<!DOCTYPE html>
<html lang="en"><head>
<meta name="robots" content="noindex"><meta charset="utf-8"/><meta content="IE=edge" http-equiv="X-UA-Compatible"/><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport"/>
<script>
window.ga =
    window.ga ||
    function() {
        ;(ga.q = ga.q || []).push(arguments)
    }
ga.l = +new Date()
ga('create', 'UA-99991864-4', 'auto')
ga('send', 'pageview')
</script>
<script async="" src="https://download.pingcap.com/js/ga-analytics.js"></script>
<link href="https://download.pingcap.com/style/github-markdown.css" rel="stylesheet"/>
<link href="/css/doc.css" rel="stylesheet"/>
<title>How We Compiled a Golang Database in the Browser Using WebAssembly | TiDB</title><link href="/images/favicon.ico" rel="icon" type="image/x-icon"/>
<link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
<link href="/images/apple-touch-icon.png" rel="apple-touch-icon"/>
<meta content="We compiled a Golang database (TiDB) into an in-browser database using WebAssembly (Wasm). This post introduces why and how we built an in-browser database." name="description"/>
<meta content="noodp" name="robots"/>
<meta content="TiDB, MySQL, HTAP, Open Source, Cloud-Native, NewSQL, Aurora Alternative" name="keywords"/>
<meta content="en_US" property="og:locale"/>
<meta content="website" property="og:type"/>
<meta content="How We Compiled a Golang Database in the Browser Using WebAssembly | TiDB" property="og:title"/>
<meta content="We compiled a Golang database (TiDB) into an in-browser database using WebAssembly (Wasm). This post introduces why and how we built an in-browser database." property="og:description"/>
<meta content="https://pingcap.com/blog/how-we-compiled-a-golang-database-in-the-browser-using-webassembly/" property="og:url"/>
<meta content="MySQL at Scale. No more manual sharding" property="og:site_name"/>
<meta content="/images/blog/how-we-compiled-a-golang-database-in-the-browser-using-webassembly.png" property="og:image"/>
<meta content="/images/blog/how-we-compiled-a-golang-database-in-the-browser-using-webassembly.png" property="og:image:secure_url"/><meta content="summary_large_image" name="twitter:card"/>
<meta content="1200" name="og:image:width"/>
<meta content="600" name="og:image:height"/><meta content="We compiled a Golang database (TiDB) into an in-browser database using WebAssembly (Wasm). This post introduces why and how we built an in-browser database." name="twitter:description"/>
<meta content="How We Compiled a Golang Database in the Browser Using WebAssembly | TiDB" name="twitter:title"/>
<meta content="@pingcap" name="twitter:site"/>
<meta content="https://download.pingcap.com/images/blog/how-we-compiled-a-golang-database-in-the-browser-using-webassembly.png" name="twitter:image"/><meta content="@pingcap" name="twitter:creator"/>
<script type="application/ld+json">
{
    "@context": "http:\/\/schema.org",
    "@type": "WebSite",
    "url": "https:\/\/pingcap.com\/",
    "name": "PingCAP",
    "potentialAction": {
        "@type": "SearchAction",
        "target": "https:\/\/pingcap.com\/?s={search_term_string}",
        "query-input": "required name=search_term_string"
    }
}
</script>
<script>
    (function(){
        var bp = document.createElement('script');
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
<script async="" src="https://accounts.pingcap.com/static/pingcap_sso/js/track.beta.js" type="text/javascript"></script>
<link as="font" crossorigin="anonymous" href="https://download.pingcap.com/fonts/lato/lato-regular-webfont.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="https://download.pingcap.com/fonts/lato/lato-regular-webfont.woff" rel="preload" type="font/woff"/>
<link as="font" crossorigin="anonymous" href="https://download.pingcap.com/fonts/lato/lato-regular-webfont.ttf" rel="preload" type="font/ttf"/>
<link as="font" crossorigin="anonymous" href="https://download.pingcap.com/fonts/titilliumweb/titilliumweb-regular-webfont.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="https://download.pingcap.com/fonts/titilliumweb/titilliumweb-regular-webfont.woff" rel="preload" type="font/woff"/>
<link as="font" crossorigin="anonymous" href="https://download.pingcap.com/fonts/titilliumweb/titilliumweb-regular-webfont.ttf" rel="preload" type="font/ttf"/>
<link as="script" href="https://download.pingcap.com/js/jquery.min.js" rel="preload"/>
<link href="/css/main.css" rel="stylesheet"/>
<link href="https://download.pingcap.com/style/docsearch.min.css" rel="stylesheet"/>
<script type="text/javascript">
var trackOutboundLink = function(url) {
  var redirectTriggered = false
  ga('send', 'event', 'outbound', 'click', url, {
    hitCallback: function() {
      redirectTriggered = true
      document.location = url
    }
  })
  setTimeout(function() {
    if (!redirectTriggered) {
      document.location = url
    }
  }, 1500)
}

var trackViews = function(btn_type, event_category) {
  var event_label = btn_type
  var eventCategory = event_category
  ga('send', 'event', {
    'eventCategory': eventCategory,
    'eventAction': 'click',
    'eventLabel': event_label,
    'transport': 'beacon'
  });
}
</script>
<script>if (location.pathname === '/') {
        if (location.hostname === 'pingcap.github.io') {
            location.href = '/en/'
        }
    }</script></head> <body data-lang="en"><div id="page-content">
<header class="fixed-top" role="navigation">
<div class="container">
<a class="nav-brand" href="/en"><img alt="PingCAP" src="/images/pingcap-logo.png"/></a>
<div class="nav-wrapper">
<div class="navigation">
<ul>
<li><a class="a-en" href="https://en.pingcap.com">Cloud</a></li>
<li><a class="a-en" href="/tidb-academy">TiDB Academy</a></li>
<li class="docs-type-selector " id="docsTypeSelector">
<a class="header-doc-nav" href="#">Docs</a>
<div class="header-dropdown-menu" id="docsTypeSelectorItem">
<a class="header-dropdown-item" href="/docs/stable/">TiDB</a>
<a class="header-dropdown-item" href="/docs/tidb-in-kubernetes/stable/">TiDB in Kubernetes</a>
<a class="header-dropdown-item" href="/docs/tidb-data-migration/stable/">TiDB Data Migration (DM)</a>
</div>
</li>
<li><a class="a-en" href="/success-stories">Success
                    Stories</a></li>
<li class="sel"><a class="a-en" href="/blog">Blog</a></li>
<li><a class="link-download link-download-en" href="/download">Free Download</a></li>
</ul>
</div>
<div class="global-search">
<div class="search-wrapper">
<span class="icon-search"><svg fill="#fff" height="18" viewbox="0 0 67.125 67.125" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M23.902 0C11.01 0 .523 10.488.523 23.38c0 12.891 10.487 23.379 23.379 23.379a23.258 23.258 0 0 0 14.471-5.037l24.816 24.817c.391.391.902.586 1.414.586s1.023-.195 1.414-.586a2 2 0 0 0 0-2.828L41.293 38.985c3.721-4.142 5.989-9.613 5.989-15.605C47.282 10.488 36.794 0 23.902 0zM4.523 23.38C4.523 12.694 13.216 4 23.902 4c10.687 0 19.38 8.694 19.38 19.38 0 5.396-2.221 10.279-5.791 13.795a1.959 1.959 0 0 0-.488.349 2.003 2.003 0 0 0-.271.343C33.31 40.9 28.825 42.76 23.903 42.76c-10.686-.001-19.38-8.695-19.38-19.38z"></path><path d="M24.075 8.591c-8.25 0-14.962 6.712-14.962 14.962a2 2 0 0 0 4 0c0-6.044 4.918-10.962 10.962-10.962a2 2 0 0 0 0-4z"></path></svg></span>
<input data-lang="en" data-type="" id="search-input" name="q" placeholder="Search TiDB Docs" type="search"/>
</div>
<script>
    const inputNode = document.getElementById("search-input")

    inputNode.addEventListener('keyup', ({key}) => {
        if (key === "Enter") {
            if ($('#search-input').data('lang') == 'cn') {
                lang = 'zh'
            }

            const query = $('#search-input').val()
            if (query) {
                url = "https://docs.pingcap.com/" + (lang == 'zh' ? 'zh/' : '') + "search/?lang=" + lang + "&type=tidb&version=v4.0&q=" + query
                window.location.href = url
            }
        }
    })
</script>
</div>
</div>
<div class="nav-btn nav-slider">
<i class="material-icons"><svg height="16" viewbox="0 0 459 459" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 382.5h459v-51H0v51zM0 255h459v-51H0v51zM0 76.5v51h459v-51H0z" fill="#FFF"></path></svg></i>
</div>
</div>
</header>
<nav class="mobile-sidebar">
<div class="nav-header">
<div class="logo-wrap">
<a class="nav-brand" href="/en"><img alt="PingCAP" src="/images/pingcap-logo.png"/></a>
</div>
</div>
<ul class="ul-base">
<li><a href="https://en.pingcap.com/">Cloud</a></li>
<li><a class="tidb-academy" href="/tidb-academy">TiDB Academy</a></li>
<li class="docs-type-selector " id="docsTypeSelector">
<p class="header-doc-nav">Docs</p>
<div class="header-dropdown-menu" id="docsTypeSelectorItem">
<a class="header-dropdown-item" href="/docs/stable/">TiDB</a>
<a class="header-dropdown-item" href="/docs/tidb-in-kubernetes/stable/">TiDB in Kubernetes</a>
<a class="header-dropdown-item" href="/docs/tidb-data-migration/stable/">TiDB Data Migration (DM)</a>
</div>
</li>
<li><a href="/success-stories">Success Stories</a></li>
<li class="sel"><a href="/blog">Blog</a></li>
<li><a class="link-download" href="/download">Free Download</a></li>
</ul>
<div class="nav-footer">
<div class="contact-list-wrap">
<div class="flex-list">
<h4 class="list-title"><strong>Contact</strong></h4>
<ul class="social ul-base">
<li><a class="twitter" href="https://twitter.com/PingCAP" target="_blank"><svg height="18" viewbox="0 0 612 612" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M612 116.258a250.714 250.714 0 0 1-72.088 19.772c25.929-15.527 45.777-40.155 55.184-69.411-24.322 14.379-51.169 24.82-79.775 30.48-22.907-24.437-55.49-39.658-91.63-39.658-69.334 0-125.551 56.217-125.551 125.513 0 9.828 1.109 19.427 3.251 28.606-104.326-5.24-196.835-55.223-258.75-131.174-10.823 18.51-16.98 40.078-16.98 63.101 0 43.559 22.181 81.993 55.835 104.479a125.556 125.556 0 0 1-56.867-15.756v1.568c0 60.806 43.291 111.554 100.693 123.104-10.517 2.83-21.607 4.398-33.08 4.398-8.107 0-15.947-.803-23.634-2.333 15.985 49.907 62.336 86.199 117.253 87.194-42.947 33.654-97.099 53.655-155.916 53.655-10.134 0-20.116-.612-29.944-1.721 55.567 35.681 121.536 56.485 192.438 56.485 230.948 0 357.188-191.291 357.188-357.188l-.421-16.253c24.666-17.593 46.005-39.697 62.794-64.861z"></path></svg></a></li>
<li><a class="linkedin" href="https://www.linkedin.com/company/pingcap/" target="_blank"><svg height="18" viewbox="0 0 438.536 438.535" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M5.424 145.895H99.64v282.932H5.424zM408.842 171.739c-19.791-21.604-45.967-32.408-78.512-32.408-11.991 0-22.891 1.475-32.695 4.427-9.801 2.95-18.079 7.089-24.838 12.419-6.755 5.33-12.135 10.278-16.129 14.844-3.798 4.337-7.512 9.389-11.136 15.104v-40.232h-93.935l.288 13.706c.193 9.139.288 37.307.288 84.508 0 47.205-.19 108.777-.572 184.722h93.931V270.942c0-9.705 1.041-17.412 3.139-23.127 4-9.712 10.037-17.843 18.131-24.407 8.093-6.572 18.13-9.855 30.125-9.855 16.364 0 28.407 5.662 36.117 16.987 7.707 11.324 11.561 26.98 11.561 46.966V428.82h93.931V266.664c-.007-41.688-9.897-73.328-29.694-94.925zM53.103 9.708c-15.796 0-28.595 4.619-38.4 13.848C4.899 32.787 0 44.441 0 58.529 0 72.42 4.758 84.034 14.275 93.358c9.514 9.325 22.078 13.99 37.685 13.99h.571c15.99 0 28.887-4.661 38.688-13.99 9.801-9.324 14.606-20.934 14.417-34.829-.19-14.087-5.047-25.742-14.561-34.973C81.562 14.323 68.9 9.708 53.103 9.708z"></path></svg></a></li>
<li><a class="reddit" href="https://www.reddit.com/r/TiDB/" target="_blank"><svg height="18" viewbox="0 0 279.748 279.748" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M279.748 133.142c0-19.299-15.701-35-35-35-10.768 0-20.674 4.812-27.279 13.064-18.532-8.431-39.663-13.626-62.015-15.271l19.206-60.692 42.895 9.294c3.285 12.782 14.901 22.258 28.693 22.258 16.336 0 29.627-13.29 29.627-29.626 0-16.336-13.291-29.627-29.627-29.627-11.801 0-21.999 6.941-26.759 16.95l-49.497-10.725a10.002 10.002 0 0 0-11.651 6.756L134.636 95.43c-26.164.638-50.988 6.053-72.356 15.775-6.606-8.251-16.512-13.063-27.28-13.063-19.299 0-35 15.701-35 35 0 9.373 3.683 18.173 10.222 24.709-3.9 8.37-5.875 17.076-5.875 25.936 0 24.048 14.396 46.492 40.538 63.199 25.447 16.264 59.183 25.221 94.989 25.221 35.808 0 69.542-8.957 94.989-25.221 26.142-16.707 40.538-39.151 40.538-63.199 0-8.859-1.975-17.565-5.875-25.936 6.539-6.537 10.222-15.336 10.222-24.709zM15.369 145.139c-2.212-3.59-3.369-7.688-3.369-11.997 0-12.682 10.317-23 23-23 5.444 0 10.558 1.851 14.649 5.258-14.622 8.302-26.132 18.289-34.28 29.739zm52.671 20.266c0-13.785 11.215-25 25-25s25 11.215 25 25-11.215 25-25 25-25-11.215-25-25zm123.119 57.054c-9.745 10.637-29.396 17.244-51.285 17.244-21.888 0-41.539-6.607-51.284-17.244a9.937 9.937 0 0 1-2.617-7.192 9.933 9.933 0 0 1 3.235-6.937 9.974 9.974 0 0 1 6.754-2.627c2.797 0 5.484 1.183 7.373 3.244 5.803 6.333 20.827 10.756 36.539 10.756s30.737-4.423 36.539-10.756a10.022 10.022 0 0 1 7.374-3.244c2.508 0 4.906.933 6.755 2.627a9.928 9.928 0 0 1 3.234 6.937 9.933 9.933 0 0 1-2.617 7.192zm-4.451-32.054c-13.785 0-25-11.215-25-25s11.215-25 25-25 25 11.215 25 25-11.215 25-25 25zm77.671-45.266c-8.147-11.45-19.657-21.436-34.28-29.739 4.092-3.408 9.205-5.258 14.649-5.258 12.683 0 23 10.318 23 23 0 4.309-1.157 8.407-3.369 11.997z"></path></svg></a></li>
<li><a class="google-plus" href="https://groups.google.com/forum/#!forum/tidb-user" target="_blank"><svg height="18" viewbox="0 0 491.858 491.858" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M377.472 224.957H201.319v58.718H308.79c-16.032 51.048-63.714 88.077-120.055 88.077-69.492 0-125.823-56.335-125.823-125.824 0-69.492 56.333-125.823 125.823-125.823 34.994 0 66.645 14.289 89.452 37.346l42.622-46.328c-34.04-33.355-80.65-53.929-132.074-53.929C84.5 57.193 0 141.693 0 245.928s84.5 188.737 188.736 188.737c91.307 0 171.248-64.844 188.737-150.989v-58.718l-.001-.001zM491.858 224.857h-36.031v-36.031h-30.886v36.031H388.91v30.883h36.031v36.032h30.886V255.74h36.031z"></path></svg></a></li>
<li><a class="stack-overflow" href="https://stackoverflow.com/questions/tagged/tidb" target="_blank"><svg height="18" viewbox="0 0 547.597 547.597" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M140.81 475.111h.024l189.91-.269c8.434-.013 15.3-6.886 15.3-15.318v-21.298c0-8.428-6.854-15.288-15.3-15.288l-189.91.264c-8.433.012-15.3 6.885-15.3 15.318v21.31c.001 8.427 6.855 15.281 15.276 15.281z"></path><path d="M58.667 517.854c.073 29.26.073 29.449 3.072 29.449h.055l10.612.294h.086s85.814 0 171.629-.036c42.914-.019 85.821-.05 118-.092 16.09-.019 29.505-.043 38.887-.074 17.803-.055 17.803-.055 17.803-3.072l.3-10.697V333.299c0-8.434-6.866-15.3-15.3-15.3h-11.909c-8.434 0-15.3 6.866-15.3 15.3V496.22c0 5.062-4.119 9.18-9.181 9.18H110.51c-5.061 0-9.18-4.118-9.18-9.18V333.299c0-8.434-6.867-15.3-15.3-15.3H73.82c-8.433 0-15.3 6.86-15.3 15.3 0 23.342.012 76.084.055 122.981.019 23.447.05 45.442.092 61.574z"></path><path d="M142.322 397.399l189.402 17.467c.478.043.948.062 1.413.062 7.956 0 14.468-5.985 15.159-13.917l1.83-21.096c.729-8.396-5.508-15.851-13.898-16.628l-189.102-17.461c-8.593-.795-15.869 5.441-16.653 13.825l-1.97 21.108a15.172 15.172 0 0 0 3.452 11.181 15.19 15.19 0 0 0 10.367 5.459zM437.636 208.849a15.253 15.253 0 0 0 17.694 12.443l21.065-3.678c8.311-1.451 13.898-9.395 12.454-17.706l-32.504-187.23c-1.42-8.207-9.21-13.917-17.692-12.448l-21.065 3.678c-8.311 1.451-13.898 9.395-12.454 17.705l32.502 187.236zM190.333 194.375l163.6 96.708a15.28 15.28 0 0 0 7.778 2.136c5.393 0 10.447-2.876 13.183-7.509l10.876-18.36c2.08-3.519 2.674-7.631 1.658-11.591a15.18 15.18 0 0 0-7.032-9.358l-163.6-96.714c-7.014-4.149-16.836-1.597-20.967 5.374l-10.869 18.36a15.2 15.2 0 0 0-1.658 11.591 15.21 15.21 0 0 0 7.031 9.363zM387.525 240.501a15.276 15.276 0 0 0 12.626 6.659c3.091 0 6.077-.924 8.635-2.681l17.405-11.934c6.953-4.768 8.752-14.314 4.015-21.292L323.29 54.104c-4.584-6.732-14.498-8.623-21.236-3.984l-17.737 12.21c-6.945 4.779-8.727 14.327-3.971 21.291l107.179 156.88zM154.482 302.319l183.465 49.156c1.298.349 2.632.526 3.966.526 6.903 0 12.98-4.67 14.762-11.347l5.508-20.624c2.179-8.152-2.681-16.555-10.826-18.74l-183.465-49.162c-8.017-2.148-16.604 2.852-18.728 10.826l-5.508 20.63c-2.179 8.142 2.68 16.551 10.826 18.735z"></path></svg></a></li>
</ul>
</div>
<div class="subscribe">
<a href="https://share.hsforms.com/1e2W03wLJQQKPd1d9rCbj_Q2npzm"><button class="btn btn-subscribe f-tc" style="margin-left: 0.75rem;">Subscribe to Blog</button></a>
</div>
</div>
<div class="container">
<a class="btn-lang" href="/blog-cn" id="lang">中文</a>
</div>
</div>
</nav>
<div class="blog">
<div class="blogArticle__container">
<div class="archive"><div class="article-nav">
<a href="/blog/#Engineering">BLOG HOME</a> <span> &gt; </span>Engineering</div><div class="content markdown-body">
<h1 class="title">How We Compiled a Golang Database in the Browser Using WebAssembly</h1>
<ul class="blog-post-meta">
<li class="meta-item">
<img alt="Date icon" src="/images/svgs/icon-date.svg"/>Sat, Nov 16, 2019</li>
<li class="meta-item">
<img alt="Pen icon" src="/images/svgs/icon-writer.svg"/>Joshua Zhou</li>
</ul>
<div class="blog-text"><p><img alt="How we compiled a Golang database in the browser using WebAssembly" class="lazy" data-original="https://download.pingcap.com/images/blog/how-we-compiled-a-golang-database-in-the-browser-using-webassembly.png" src="/images/svgs/loader-spinner.svg"/></p>
<p>As Queeny Jin mentioned in her article, <a href="https://pingcap.com/blog/tidb-in-the-browser-running-a-golang-database-on-webassembly/">TiDB in the Browser: Running a Golang Database on WebAssembly</a>, we compiled TiDB into an in-browser database using WebAssembly (Wasm). We're very proud of this pilot project because it opens a door to an entirely new world for both Golang and Wasm:</p>
<ul>
<li>
<p>It is probably the first Golang database that's been compiled to Wasm. As “<a href="https://golangweekly.com/issues/287">Golang weekly (issue 287)</a>” put it, “The author wonders if a database like TiDB written in Go can run in a web browser, what about other complex Go apps? Go's WebAssembly future is looking quite positive.”</p>
</li>
<li>
<p>Besides <a href="https://github.com/kripken/sql.js/">SQLite</a>, Wasm has one more database example that can run inside the browser. As <a href="https://dbweekly.com/issues/279">Database Weekly (issue 279)</a> put it, ”If a database like TiDB written in Go can run in the browser, what about other complex Go apps or other database systems?”</p>
</li>
</ul>
<p>What's most exciting is that beginning database users now have an easy way to learn to write SQL statements or test new databases. They don't have to download an entire database and go through the complex setup and configuration process to be able to write SQL. They can simply point their browser to <a href="https://tour.tidb.io/">https://tour.tidb.io/</a>, wait a few seconds for the TiDB database to load, and then start to write SQL statements.</p>
<p>The time to experiment with SQL without pain has come. In fact, the community has started to hack on this project, and they've built a markdown-it plugin to run a TiDB Wasm instance on markdown. Now you can have an interactive playground to learn SQL in the browser: <a href="https://github.com/imiskolee/tidb-wasm-markdown">https://github.com/imiskolee/tidb-wasm-markdown</a></p>
<p>The source code for this project is in <a href="https://github.com/pingcap/tidb/pull/13069">PR: #13069 - support compiling tidb to wasm</a>. You are welcome to join us!</p>
<p>The rest of this blog will dive deep into how and why we built an in-browser database. By the end of the article, you'll know how to reproduce it yourself, create your own projects, and get inspired.</p>
<p><strong>TL;DR</strong></p>
<h2 id="-want-to-make-your-own-golang-apps-run-in-a-browser-heres-what-we-learned--"><em>Want to make your own Golang apps run in a browser? Here's what we learned …</em></h2>
<p><em>We had a lot of fun—and learned a lot—from our little adventure at TiDB Hackathon 2019. If you want to make your own Golang applications run in a browser, here are some suggestions:</em></p>
<ul>
<li>
<p><em>As <a href="https://wasmweekly.news/issue-100/">WebAssembly Weekly - Issue #100</a> mentioned, “WebAssembly support for Go applications is very much in its infancy.” For example, Golang hasn't fully supported WASI, and goleveldb doesn't support Wasm/js. Be discreet before you go too deep, and clearly understand the use cases for your application.</em></p>
</li>
<li>
<p><em>Make sure your application doesn't have third-party platform-specific dependencies that can't be compiled to Wasm.</em></p>
</li>
<li>
<p><em>Browsers don't allow port listening and file operations, so you'll have to work around those limitations.</em></p>
</li>
</ul>
<h2 id="why-an-in-browser-database">Why an in-browser database?</h2>
<p>The idea came to us when we were planning our TiDB Hackathon 2019. The goal of participating in the Hackathon was very simple: hack something cool together! (So cool that we name ourselves: Ti-Cool.) What could be cooler than an in-browser database?</p>
<h2 id="how-we-made-it-possible">How we made it possible?</h2>
<p>It's a hackathon, so we hack, of course. =)</p>
<p>Let's take a look at our goal again: building an in-browser TiDB database. Breaking it down, we got a few questions to answer:</p>
<ol>
<li>Can TiDB be compiled to an in-browser application? If yes, how?</li>
<li>How can users input the SQL statements and get their results just from the browser?</li>
</ol>
<p>Let's find out.</p>
<h3 id="question-1-can-tidb-be-compiled-to-an-in-browser-application-if-yes-how">Question #1: Can TiDB be compiled to an in-browser application? If yes, how?</h3>
<p><strong>What we knew:</strong> TiDB is written in Golang, and Go 1.11 added a port to WebAssembly.</p>
<p><strong>What we didn't know:</strong> Does TiDB include any platform-specific libraries that can't be compiled to Wasm?</p>
<p>We started our adventure of compiling TiDB to Wasm by following <a href="https://github.com/golang/go/wiki/WebAssembly#getting-started">getting started with WebAssembly</a>. Here was our first setback:</p>
<p><img alt="Getting started with WebAssembly" class="lazy" data-original="https://download.pingcap.com/images/blog/getting-started-with-webassembly.png" src="/images/svgs/loader-spinner.svg"/></p>
<p>Going through the goleveldb code and the storage package led to the heartbreaking fact that even though it had implementations for most platforms, it didn't have one for Wasm:</p>
<p><img alt="The goleveldb code and the storage package" class="lazy" data-original="https://download.pingcap.com/images/blog/goleveldb-code-and-the-storage-package.png" src="/images/svgs/loader-spinner.svg"/></p>
<p>That's why we had the <code>undefined</code> error messages about <code>newFileLock</code>, <code>rename</code>, <code>syncDir</code>, etc.</p>
<p>As shown in the code below, we decided to add a <code>file_storage_js.go</code> file and leave those functions unimplemented:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">storage</span>

<span style="color:#f92672">import</span> (
 <span style="color:#e6db74">"os"</span>
 <span style="color:#e6db74">"syscall"</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">newFileLock</span>(<span style="color:#a6e22e">path</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">readOnly</span> <span style="color:#66d9ef">bool</span>) (<span style="color:#a6e22e">fl</span> <span style="color:#a6e22e">fileLock</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
 <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">syscall</span>.<span style="color:#a6e22e">ENOTSUP</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">setFileLock</span>(<span style="color:#a6e22e">f</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">File</span>, <span style="color:#a6e22e">readOnly</span>, <span style="color:#a6e22e">lock</span> <span style="color:#66d9ef">bool</span>) <span style="color:#66d9ef">error</span> {
 <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">syscall</span>.<span style="color:#a6e22e">ENOTSUP</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">rename</span>(<span style="color:#a6e22e">oldpath</span>, <span style="color:#a6e22e">newpath</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">error</span> {
 <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">syscall</span>.<span style="color:#a6e22e">ENOTSUP</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">isErrInvalid</span>(<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) <span style="color:#66d9ef">bool</span> {
 <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">syncDir</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">error</span> {
 <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">syscall</span>.<span style="color:#a6e22e">ENOTSUP</span>
}
</code></pre></div><p>We compiled the code again and got this:</p>
<p><img alt="Missing function body" class="lazy" data-original="https://download.pingcap.com/images/blog/missing-function-body.png" src="/images/svgs/loader-spinner.svg"/></p>
<p>Um… What does <code>missing function body</code> mean?</p>
<p>Diving deep into the code, we found that there were function declarations in the <code>arith_decl.go</code> file but the functions weren't implemented in the system-specific files.</p>
<p>This problem was similar to the one we had before, and we could solve it the same way, except there was a  problem: this code belonged to a third-party library and was not in our control. Besides, TiDB did not depend on the library directly—it depended on the <code>mathutil</code> library which depended on the <code>bigfft</code> library, and neither of these libraries was in our control. Two plans came to our minds:</p>
<ul>
<li>
<p>Plan 1. File pull requests to the <code>mathutil</code> and <code>bigfft</code> libraries so that they can support Wasm.</p>
</li>
<li>
<p>Plan 2. Clone the <code>mathutil</code> and <code>bigfft</code> libraries, add the functions and leave them unimplemented, and change the TiDB dependency to our cloned libraries.</p>
</li>
</ul>
<p>Plan 1 was quickly ruled out because we couldn't do it in time for the hackathon, not to mention we had no idea whether the maintainers of these two projects would approve our changes and merge them.</p>
<p>Plan 2 had its own problem because it meant we would probably detach ourselves from the upstreams.</p>
<p>Was there a third way? Could we make a special case where TiDB didn't depend on these two libraries when we compile the Wasm binary format, but when it came to the binary format for other platforms like Linux, it's business as usual?</p>
<p>With this goal in mind, we did some homework. We found that even though <code>mathutil</code> was called many times, only the following functions were used: <code>MinUint64</code>, <code>MaxUint64</code>，<code>MinInt32</code>，<code>MaxInt32</code>, etc. So we had an idea:</p>
<ol>
<li>
<p>Create the <code>mathutil</code> directory, then the <code>mathutil_linux.go</code> and <code>mathutil_js.go</code> files.</p>
</li>
<li>
<p>In the <code>mathutil_linux.go</code> file, re-export to the third party libraries.</p>
</li>
<li>
<p>In the <code>mathutil_js.go</code> file, create these functions and leave them unimplemented, with no dependency on any third-party libraries.</p>
</li>
<li>
<p>Switch all the dependency on third-party libraries to the <code>mathutil</code> directory so that only the <code>mathutil</code> directory included the third-party package that didn't support Wasm.</p>
</li>
</ol>
<p>In this way, the <code>mathutil</code> directory provided all the functions in the original <code>mathutil</code> package. In addition, when compiling TiDB for other platforms (Linux), it could still go to the <code>mathutil_linux.go</code> file which led to the third-party libraries; when compiling TiDB for Wasm, it could go to the <code>mathutil_js.go</code> file.</p>
<p>Compiling again:</p>
<p><img alt="TiDB could be compiled to an in-browser application" class="lazy" data-original="https://download.pingcap.com/images/blog/tidb-could-be-compiled-to-an-in-browser-application.png" src="/images/svgs/loader-spinner.svg"/></p>
<p>Yay! We made it! The <code>main.wasm</code> is the compiled TiDB Wasm file we wanted, and it proves that TiDB could be compiled to an in-browser application.</p>
<p>Ok. Now we have a compiled TiDB Wasm. Let's run it, and see what comes out!</p>
<p>Theoretically, because we were using <code>os.Stdin</code> as the input and the <code>os.Stdout</code> as the output, and we hadn't done anything with DOM yet, the output should be blank. However, TiDB outputs its log to <code>os.Stdout</code>, we expect a log message that TiDB started successfully. Unfortunately, this was what we got:</p>
<p><img alt="Runtime didn't implement os.stat" class="lazy" data-original="https://download.pingcap.com/images/blog/runtime-did-not-implement-os-stat.png" src="/images/svgs/loader-spinner.svg"/></p>
<p>What we could derive from the error message was that the runtime didn't implement <code>os.stat</code>. We determined that this was because Golang hasn't fully supported WASI yet. As shown in the following code, it merely mocked an <code>fs</code> in <code>wasm_exec.js</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">global</span>.<span style="color:#a6e22e">fs</span> <span style="color:#f92672">=</span> {
        <span style="color:#a6e22e">writeSync</span>(<span style="color:#a6e22e">fd</span>, <span style="color:#a6e22e">buf</span>) {
                ...
        },
        <span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">fd</span>, <span style="color:#a6e22e">buf</span>, <span style="color:#a6e22e">offset</span>, <span style="color:#a6e22e">length</span>, <span style="color:#a6e22e">position</span>, <span style="color:#a6e22e">callback</span>) {
                ...
        },
        <span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">path</span>, <span style="color:#a6e22e">flags</span>, <span style="color:#a6e22e">mode</span>, <span style="color:#a6e22e">callback</span>) {
                ...
        },
        ...
}
</code></pre></div><p>The mocked <code>fs</code> didn't implement the callbacks such as <code>stat</code>, <code>lstat</code>, <code>unlink</code>, <code>mkdir</code>. So we mocked these functions in the global <code>fs</code> object before the Wasm was started:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">unimplemented</span>(<span style="color:#a6e22e">callback</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">"not implemented"</span>);
    <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">"ENOSYS"</span>;
    <span style="color:#a6e22e">callback</span>(<span style="color:#a6e22e">err</span>);
}
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">unimplemented1</span>(<span style="color:#a6e22e">_1</span>, <span style="color:#a6e22e">callback</span>) { <span style="color:#a6e22e">unimplemented</span>(<span style="color:#a6e22e">callback</span>); }
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">unimplemented2</span>(<span style="color:#a6e22e">_1</span>, <span style="color:#a6e22e">_2</span>, <span style="color:#a6e22e">callback</span>) { <span style="color:#a6e22e">unimplemented</span>(<span style="color:#a6e22e">callback</span>); }

<span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">stat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">unimplemented1</span>;
<span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">lstat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">unimplemented1</span>;
<span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">unlink</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">unimplemented1</span>;
<span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">rmdir</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">unimplemented1</span>;
<span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">mkdir</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">unimplemented2</span>;
<span style="color:#a6e22e">go</span>.<span style="color:#a6e22e">run</span>(<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">instance</span>);
</code></pre></div><div class="trackable-btns">
<a href="/download" onclick="trackViews('How We Compiled a Golang Database in the Browser Using WebAssembly', 'download-tidb-btn-middle')"><button>Download TiDB</button></a>
<a href="https://share.hsforms.com/1e2W03wLJQQKPd1d9rCbj_Q2npzm" onclick="trackViews('How We Compiled a Golang Database in the Browser Using WebAssembly', 'subscribe-blog-btn-middle')"><button>Subscribe to Blog</button></a>
</div>
<p>When we refreshed the page, the expected TiDB log was finally displayed:</p>
<p><img alt="TiDB log was finally displayed" class="lazy" data-original="https://download.pingcap.com/images/blog/tidb-log-was-finally-displayed.png" src="/images/svgs/loader-spinner.svg"/></p>
<p>Yay, we made it again!</p>
<p>At this point, we had cleared all the technical blockers. Now it was time to get inputs and outputs.</p>
<h3 id="question--2-how-can-users-input-the-sql-statements-and-get-their-results-from-the-browser">Question # 2: How can users input the SQL statements and get their results from the browser?</h3>
<p>We all know that browsers cannot let the web applications within them do dangerous things such as port listening and file operations. However, TiDB lets users start a client and connect to TiDB using MySQL statements (<a href="https://pingcap.com/docs/stable/reference/mysql-compatibility/">mostly</a>), which means users need to listen on a certain port. We want our users to have a built-in TiDB client in the Wasm file together with the TiDB sever: When the browser loads the Wasm file, the client is launched immediately to allow users to input SQL statements and output the SQL results.</p>
<p>Here is what we did:</p>
<ol>
<li>
<p>Reuse what's already in the TiDB test code. We looked through the test code in TiDB and <a href="https://github.com/pingcap/tidb/search?q=MustQuery%28%22select+count%28*%29&amp;unscoped_q=MustQuery%28%22select+count%28*%29">found the following</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">result</span> = <span style="color:#a6e22e">tk</span>.<span style="color:#a6e22e">MustQuery</span>(<span style="color:#e6db74">"select count(*) from t group by d order by c"</span>)
<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Check</span>(<span style="color:#a6e22e">testkit</span>.<span style="color:#a6e22e">Rows</span>(<span style="color:#e6db74">"3"</span>, <span style="color:#e6db74">"2"</span>, <span style="color:#e6db74">"2"</span>))
</code></pre></div></li>
<li>
<p>Locate the <code>tk</code> function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Exec executes a sql statement.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">tk</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TestKit</span>) <span style="color:#a6e22e">Exec</span>(<span style="color:#a6e22e">sql</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">interface</span>{}) (<span style="color:#a6e22e">sqlexec</span>.<span style="color:#a6e22e">RecordSet</span>, <span style="color:#66d9ef">error</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tk</span>.<span style="color:#a6e22e">Se</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#a6e22e">tk</span>.<span style="color:#a6e22e">Se</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">CreateSession4Test</span>(<span style="color:#a6e22e">tk</span>.<span style="color:#a6e22e">store</span>)
        <span style="color:#a6e22e">tk</span>.<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Assert</span>(<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">check</span>.<span style="color:#a6e22e">IsNil</span>)
        <span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">atomic</span>.<span style="color:#a6e22e">AddUint64</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">connectionID</span>, <span style="color:#ae81ff">1</span>)
        <span style="color:#a6e22e">tk</span>.<span style="color:#a6e22e">Se</span>.<span style="color:#a6e22e">SetConnectionID</span>(<span style="color:#a6e22e">id</span>)
    }
    <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">args</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rss</span> []<span style="color:#a6e22e">sqlexec</span>.<span style="color:#a6e22e">RecordSet</span>
        <span style="color:#a6e22e">rss</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">tk</span>.<span style="color:#a6e22e">Se</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">sql</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> <span style="color:#f92672">&amp;&amp;</span> len(<span style="color:#a6e22e">rss</span>) &gt; <span style="color:#ae81ff">0</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">rss</span>[<span style="color:#ae81ff">0</span>], <span style="color:#66d9ef">nil</span>
        }
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">Trace</span>(<span style="color:#a6e22e">err</span>)
    }
    <span style="color:#a6e22e">stmtID</span>, <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tk</span>.<span style="color:#a6e22e">Se</span>.<span style="color:#a6e22e">PrepareStmt</span>(<span style="color:#a6e22e">sql</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">Trace</span>(<span style="color:#a6e22e">err</span>)
    }
    <span style="color:#a6e22e">params</span> <span style="color:#f92672">:=</span> make([]<span style="color:#a6e22e">types</span>.<span style="color:#a6e22e">Datum</span>, len(<span style="color:#a6e22e">args</span>))
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; len(<span style="color:#a6e22e">params</span>); <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
        <span style="color:#a6e22e">params</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">types</span>.<span style="color:#a6e22e">NewDatum</span>(<span style="color:#a6e22e">args</span>[<span style="color:#a6e22e">i</span>])
    }
    <span style="color:#a6e22e">rs</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tk</span>.<span style="color:#a6e22e">Se</span>.<span style="color:#a6e22e">ExecutePreparedStmt</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">stmtID</span>, <span style="color:#a6e22e">params</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">Trace</span>(<span style="color:#a6e22e">err</span>)
    }
    <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">tk</span>.<span style="color:#a6e22e">Se</span>.<span style="color:#a6e22e">DropPreparedStmt</span>(<span style="color:#a6e22e">stmtID</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">Trace</span>(<span style="color:#a6e22e">err</span>)
    }
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">rs</span>, <span style="color:#66d9ef">nil</span>
}
</code></pre></div></li>
<li>
<p>Write a read-eval-print-loop (REPL) to take inputs, execute them using the above <code>Exec</code> function, return the result to standard output, and loop the entire process.</p>
</li>
</ol>
<h3 id="what-about-the-terminal">What about the terminal?</h3>
<p>We now had an <code>Exec</code> function that could take SQL statements, output the result, and run in the browser. We also needed an SQL client to interact with the function. We considered the following options:</p>
<ul>
<li>Use Golang to manipulate dom to implement this client.</li>
<li>Use Golang to expose the <code>Exec</code> function to the global, and find an existing SQL client/terminal in JavaScript(JS) to interact with the <code>Exec</code> function.</li>
</ul>
<p>Our current team members have limited front-end knowledge, so we chose the second approach. We found the <code>jquery.console.js</code> library, which required only a callback from the SQL, and our <code>Exec</code> fit right in.</p>
<p>Here are the specific steps:</p>
<ol>
<li>
<p>Exposed the <code>Exec</code> function globally to be called back by JS:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">js</span>.<span style="color:#a6e22e">Global</span>().<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">"executeSQL"</span>, <span style="color:#a6e22e">js</span>.<span style="color:#a6e22e">FuncOf</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">this</span> <span style="color:#a6e22e">js</span>.<span style="color:#a6e22e">Value</span>, <span style="color:#a6e22e">args</span> []<span style="color:#a6e22e">js</span>.<span style="color:#a6e22e">Value</span>) <span style="color:#66d9ef">interface</span>{} {
    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
    <span style="color:#75715e">// Simplified code
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">sql</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">String</span>()
        <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">Invoke</span>(<span style="color:#a6e22e">k</span>.<span style="color:#a6e22e">Exec</span>(<span style="color:#a6e22e">sql</span>))
    }()
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}))
</code></pre></div><p>Result: We can run SQL from the browser console:</p>
<p><img alt="Run SQL from the browser console" class="lazy" data-original="https://download.pingcap.com/images/blog/run-sql-from-the-browser-console.png" src="/images/svgs/loader-spinner.svg"/></p>
</li>
<li>
<p>Built an SQL client using <code>jquery.console.js</code> and passed the <code>executeSQL</code> as callbacks:</p>
<p>Result: Now you can run the Golang database the SQL directly in your browser!</p>
<p><img alt="Run the Golang database in the browser" class="lazy" data-original="https://download.pingcap.com/images/blog/run-the-golang-database-in-the-browser.png" src="/images/svgs/loader-spinner.svg"/></p>
</li>
</ol>
<h3 id="one-more-thing-taking-in-local-files">One more thing: taking in local files</h3>
<p>Our users now have an in-browser database where they can write SQL directly. However, there's a small problem: they can only write one SQL statement at one time.</p>
<p>Imagine if a user wanted to test the compatibility between TiDB and MySQL. It would be a nightmare to run the statements one by one.</p>
<p>However, in TiDB we have features such as <code>load stats</code> and <code>load data</code> to read and load content from files into the databases, see <a href="https://pingcap.com/docs/v3.0/reference/sql/statements/load-data/">for more information</a>. But as we mentioned earlier, this was not possible for a browser.</p>
<p>To resolve this issue, we did the following:</p>
<ol>
<li>
<p>Opened the browser's <code>upload</code> window so users could choose a file and upload it to TiDB:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">js</span>.<span style="color:#a6e22e">Global</span>().<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">"upload"</span>).<span style="color:#a6e22e">Invoke</span>(<span style="color:#a6e22e">js</span>.<span style="color:#a6e22e">FuncOf</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">this</span> <span style="color:#a6e22e">js</span>.<span style="color:#a6e22e">Value</span>, <span style="color:#a6e22e">args</span> []<span style="color:#a6e22e">js</span>.<span style="color:#a6e22e">Value</span>) <span style="color:#66d9ef">interface</span>{} {
    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
        <span style="color:#a6e22e">fileContent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">String</span>()
        <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">e</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">doSomething</span>(<span style="color:#a6e22e">fileContent</span>)
        <span style="color:#a6e22e">c</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">e</span>
    }()
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}), <span style="color:#a6e22e">js</span>.<span style="color:#a6e22e">FuncOf</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">this</span> <span style="color:#a6e22e">js</span>.<span style="color:#a6e22e">Value</span>, <span style="color:#a6e22e">args</span> []<span style="color:#a6e22e">js</span>.<span style="color:#a6e22e">Value</span>) <span style="color:#66d9ef">interface</span>{} {
    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
        <span style="color:#a6e22e">c</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">String</span>())
    }()
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}))
</code></pre></div></li>
<li>
<p>Added a <code>source</code> command. Users can run the <code>source</code> command to upload a SQL file, and the TiDB Wasm executes the SQL statements in the file.</p>
<p>For example, users could enter the <code>source</code> command. The browser displays a window for you to load an SQL file.</p>
<p><img alt="Load an SQL file" class="lazy" data-original="https://download.pingcap.com/images/blog/load-an-sql-file.png" src="/images/svgs/loader-spinner.svg"/></p>
<p>If you load the <code>test.sql</code> file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> samp_db;

USE samp_db;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> person (
    number INT(<span style="color:#ae81ff">11</span>),
    name VARCHAR(<span style="color:#ae81ff">255</span>),
    birthday DATE
);

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">INDEX</span> person_num <span style="color:#66d9ef">ON</span> person (number);

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> person <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">"</span><span style="color:#e6db74">1</span><span style="color:#e6db74">"</span>,<span style="color:#e6db74">"</span><span style="color:#e6db74">tom</span><span style="color:#e6db74">"</span>,<span style="color:#e6db74">"</span><span style="color:#e6db74">20170912</span><span style="color:#e6db74">"</span>);

<span style="color:#66d9ef">UPDATE</span> person <span style="color:#66d9ef">SET</span> birthday<span style="color:#f92672">=</span><span style="color:#e6db74">'</span><span style="color:#e6db74">20171010</span><span style="color:#e6db74">'</span> <span style="color:#66d9ef">WHERE</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">'</span><span style="color:#e6db74">tom</span><span style="color:#e6db74">'</span>;
</code></pre></div><p>And then show the database, you see the following results:</p>
<p><img alt="The result" class="lazy" data-original="https://download.pingcap.com/images/blog/the-result.png" src="/images/svgs/loader-spinner.svg"/></p>
</li>
</ol>
<h2 id="whats-next">What's next</h2>
<p>Because of the limited time in Hackathon, TiDB Wasm could only serve as a pilot project. If you use TiDB Wasm, keep in mind these <a href="https://pingcap.com/blog/tidb-in-the-browser-running-a-golang-database-on-webassembly/#what-are-the-limitations">caveats</a>. We also have a lot more work to do, including the following:</p>
<ul>
<li>
<p>Persist data using IndexedDB, and implement a storage interface for IndexDB.</p>
</li>
<li>
<p>Apply P2P technologies such as WebRTC to provide service to other browsers. We believe there will be more and more applications migrating to Wasm and many of them will need databases like TiDB Wasm.</p>
</li>
<li>
<p>Make the Wasm files smaller. The current files are almost 80 MB and occupy too much memory. This is not friendly to browser. (Thanks a lot to <a href="https://github.com/syrusakbary">Syrus Akbary</a> for compiling TiDB to WASI; it's a pity that it's too large to run on any runtime.)</p>
</li>
<li>
<p>Publish TiDB to WAPM and run it in <a href="https://webassembly.sh/">WebAssembly shell</a>.</p>
</li>
<li>
<p>And more…</p>
</li>
</ul>
<p>You are welcome to join us and build this project together at <a href="https://github.com/pingcap/tidb/projects/27">https://github.com/pingcap/tidb/projects/27</a> or contact us at <a href="mailto:info@pingcap.com">info@pingcap.com</a>.</p>
</div>
</div>
<div class="article-toc"></div><div class="ssba-wrap">
<div class="ssba">
<a class="ssba_twitter_share" data-site="" href="http://twitter.com/share?url=https%3a%2f%2fpingcap.com%2fblog%2fhow-we-compiled-a-golang-database-in-the-browser-using-webassembly%2f" target="_blank">
<img alt="Twitter icon" src="/images/svgs/twitter-icon.svg"/>
</a>
<a class="ssba_reddit_share" data-site="reddit" href="http://reddit.com/submit?url=https%3a%2f%2fpingcap.com%2fblog%2fhow-we-compiled-a-golang-database-in-the-browser-using-webassembly%2f&amp;title=How%20We%20Compiled%20a%20Golang%20Database%20in%20the%20Browser%20Using%20WebAssembly" target="_blank">
<img alt="Reddit icon" src="/images/svgs/reddit-icon.svg"/>
</a>
<a class="ssba_facebook_share" data-site="" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpingcap.com%2fblog%2fhow-we-compiled-a-golang-database-in-the-browser-using-webassembly%2f" target="_blank">
<img alt="Fackbook icon" src="/images/svgs/facebook-icon.svg"/>
</a>
<a class="ssba_linkedin_share" data-site="linkedin" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fpingcap.com%2fblog%2fhow-we-compiled-a-golang-database-in-the-browser-using-webassembly%2f" target="_blank">
<img alt="Linkedin icon" src="/images/svgs/linkedin-icon.svg"/>
</a>
<a class="ssba_hackernews_share" data-site="hackernews" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpingcap.com%2fblog%2fhow-we-compiled-a-golang-database-in-the-browser-using-webassembly%2f&amp;t=How%20We%20Compiled%20a%20Golang%20Database%20in%20the%20Browser%20Using%20WebAssembly" target="_blank">
<img alt="Hacker News icon" src="/images/svgs/hacker-news-icon.svg"/>
</a>
</div>
</div>
<div class="trackable-btns">
<a href="/download" onclick="trackViews('How We Compiled a Golang Database in the Browser Using WebAssembly', 'download-tidb-btn-bottom')"><button>Download
                        TiDB</button></a>
<a href="https://share.hsforms.com/1e2W03wLJQQKPd1d9rCbj_Q2npzm" onclick="trackViews('How We Compiled a Golang Database in the Browser Using WebAssembly', 'subscribe-blog-btn-bottom')"><button>Subscribe to
                        Blog</button></a>
</div>
</div>
<div class="sidebar-page">
<div class="sticky-sidebar">
<p class="toc-title">What’s on this page</p>
<div id="smart_toc_wrapper"></div>
</div>
</div>
</div>
</div>
<footer>
<div class="container">
<div class="flex-list-wrap">
<div class="flex-list">
<h4 class="list-title"><strong>Product</strong></h4>
<ul>
<li><a href="/docs/v3.0/">TiDB</a></li>
<li><a href="/docs/v3.0/reference/tispark/">TiSpark</a></li>
<li><a href="/docs/v3.0/roadmap/">Roadmap</a></li>
</ul>
</div>
<div class="flex-list">
<h4 class="list-title"><strong>Docs</strong></h4>
<ul>
<li><a href="/docs/stable/quick-start-with-tidb/">Quick Start</a></li>
<li><a href="/blog/2017-07-24-tidbbestpractice/">Best Practices</a></li>
<li><a href="/docs/stable/faq/tidb/">FAQ</a></li>
<li><a href="/docs/stable/reference/tools/user-guide/">TiDB Tools</a></li>
<li><a href="/docs/dev/releases/rn/">Release Notes</a></li>
</ul>
</div>
<div class="flex-list">
<h4 class="list-title"><strong>Resources</strong></h4>
<ul>
<li><a href="/blog/">Blog</a></li>
<li><a href="/weekly/">Monthly</a></li>
<li><a href="https://github.com/pingcap" target="_blank">GitHub</a></li>
<li><a href="/community">TiDB Community</a></li>
</ul>
</div>
<div class="flex-list">
<h4 class="list-title"><strong>Company</strong></h4>
<ul>
<li><a href="/about/">About</a></li>
<li><a href="https://angel.co/pingcap-1/jobs" target="_blank">Careers</a></li>
<li><a href="/news/">News</a></li>
<li><a href="/contact-us/">Contact Us</a></li>
<li><a href="/privacy-policy/">Privacy Policy</a></li>
<li><a href="/terms-of-service/">Terms of Service</a></li>
</ul>
</div>
</div>
<div class="contact-list-wrap">
<div class="flex-list">
<h4 class="list-title"><strong>Connect</strong></h4>
<ul>
<li><a class="twitter" href="https://twitter.com/PingCAP" target="_blank"><svg height="19" viewbox="0 0 612 612" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M612 116.258a250.714 250.714 0 0 1-72.088 19.772c25.929-15.527 45.777-40.155 55.184-69.411-24.322 14.379-51.169 24.82-79.775 30.48-22.907-24.437-55.49-39.658-91.63-39.658-69.334 0-125.551 56.217-125.551 125.513 0 9.828 1.109 19.427 3.251 28.606-104.326-5.24-196.835-55.223-258.75-131.174-10.823 18.51-16.98 40.078-16.98 63.101 0 43.559 22.181 81.993 55.835 104.479a125.556 125.556 0 0 1-56.867-15.756v1.568c0 60.806 43.291 111.554 100.693 123.104-10.517 2.83-21.607 4.398-33.08 4.398-8.107 0-15.947-.803-23.634-2.333 15.985 49.907 62.336 86.199 117.253 87.194-42.947 33.654-97.099 53.655-155.916 53.655-10.134 0-20.116-.612-29.944-1.721 55.567 35.681 121.536 56.485 192.438 56.485 230.948 0 357.188-191.291 357.188-357.188l-.421-16.253c24.666-17.593 46.005-39.697 62.794-64.861z"></path></svg> Twitter</a></li>
<li><a class="linkedin" href="https://www.linkedin.com/company/pingcap/" target="_blank"><svg height="16" viewbox="0 0 438.536 438.535" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M5.424 145.895H99.64v282.932H5.424zM408.842 171.739c-19.791-21.604-45.967-32.408-78.512-32.408-11.991 0-22.891 1.475-32.695 4.427-9.801 2.95-18.079 7.089-24.838 12.419-6.755 5.33-12.135 10.278-16.129 14.844-3.798 4.337-7.512 9.389-11.136 15.104v-40.232h-93.935l.288 13.706c.193 9.139.288 37.307.288 84.508 0 47.205-.19 108.777-.572 184.722h93.931V270.942c0-9.705 1.041-17.412 3.139-23.127 4-9.712 10.037-17.843 18.131-24.407 8.093-6.572 18.13-9.855 30.125-9.855 16.364 0 28.407 5.662 36.117 16.987 7.707 11.324 11.561 26.98 11.561 46.966V428.82h93.931V266.664c-.007-41.688-9.897-73.328-29.694-94.925zM53.103 9.708c-15.796 0-28.595 4.619-38.4 13.848C4.899 32.787 0 44.441 0 58.529 0 72.42 4.758 84.034 14.275 93.358c9.514 9.325 22.078 13.99 37.685 13.99h.571c15.99 0 28.887-4.661 38.688-13.99 9.801-9.324 14.606-20.934 14.417-34.829-.19-14.087-5.047-25.742-14.561-34.973C81.562 14.323 68.9 9.708 53.103 9.708z"></path></svg> LinkedIn</a></li>
<li><a class="reddit" href="https://www.reddit.com/r/TiDB/" target="_blank"><svg height="18" viewbox="0 0 279.748 279.748" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M279.748 133.142c0-19.299-15.701-35-35-35-10.768 0-20.674 4.812-27.279 13.064-18.532-8.431-39.663-13.626-62.015-15.271l19.206-60.692 42.895 9.294c3.285 12.782 14.901 22.258 28.693 22.258 16.336 0 29.627-13.29 29.627-29.626 0-16.336-13.291-29.627-29.627-29.627-11.801 0-21.999 6.941-26.759 16.95l-49.497-10.725a10.002 10.002 0 0 0-11.651 6.756L134.636 95.43c-26.164.638-50.988 6.053-72.356 15.775-6.606-8.251-16.512-13.063-27.28-13.063-19.299 0-35 15.701-35 35 0 9.373 3.683 18.173 10.222 24.709-3.9 8.37-5.875 17.076-5.875 25.936 0 24.048 14.396 46.492 40.538 63.199 25.447 16.264 59.183 25.221 94.989 25.221 35.808 0 69.542-8.957 94.989-25.221 26.142-16.707 40.538-39.151 40.538-63.199 0-8.859-1.975-17.565-5.875-25.936 6.539-6.537 10.222-15.336 10.222-24.709zM15.369 145.139c-2.212-3.59-3.369-7.688-3.369-11.997 0-12.682 10.317-23 23-23 5.444 0 10.558 1.851 14.649 5.258-14.622 8.302-26.132 18.289-34.28 29.739zm52.671 20.266c0-13.785 11.215-25 25-25s25 11.215 25 25-11.215 25-25 25-25-11.215-25-25zm123.119 57.054c-9.745 10.637-29.396 17.244-51.285 17.244-21.888 0-41.539-6.607-51.284-17.244a9.937 9.937 0 0 1-2.617-7.192 9.933 9.933 0 0 1 3.235-6.937 9.974 9.974 0 0 1 6.754-2.627c2.797 0 5.484 1.183 7.373 3.244 5.803 6.333 20.827 10.756 36.539 10.756s30.737-4.423 36.539-10.756a10.022 10.022 0 0 1 7.374-3.244c2.508 0 4.906.933 6.755 2.627a9.928 9.928 0 0 1 3.234 6.937 9.933 9.933 0 0 1-2.617 7.192zm-4.451-32.054c-13.785 0-25-11.215-25-25s11.215-25 25-25 25 11.215 25 25-11.215 25-25 25zm77.671-45.266c-8.147-11.45-19.657-21.436-34.28-29.739 4.092-3.408 9.205-5.258 14.649-5.258 12.683 0 23 10.318 23 23 0 4.309-1.157 8.407-3.369 11.997z"></path></svg>Reddit</a></li>
<li><a class="google-plus" href="https://groups.google.com/forum/#!forum/tidb-user" target="_blank"><svg height="20" viewbox="0 0 491.858 491.858" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M377.472 224.957H201.319v58.718H308.79c-16.032 51.048-63.714 88.077-120.055 88.077-69.492 0-125.823-56.335-125.823-125.824 0-69.492 56.333-125.823 125.823-125.823 34.994 0 66.645 14.289 89.452 37.346l42.622-46.328c-34.04-33.355-80.65-53.929-132.074-53.929C84.5 57.193 0 141.693 0 245.928s84.5 188.737 188.736 188.737c91.307 0 171.248-64.844 188.737-150.989v-58.718l-.001-.001zM491.858 224.857h-36.031v-36.031h-30.886v36.031H388.91v30.883h36.031v36.032h30.886V255.74h36.031z"></path></svg>Google Group</a></li>
<li><a class="stack-overflow" href="https://stackoverflow.com/questions/tagged/tidb" target="_blank"><svg height="17" viewbox="0 0 547.597 547.597" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M140.81 475.111h.024l189.91-.269c8.434-.013 15.3-6.886 15.3-15.318v-21.298c0-8.428-6.854-15.288-15.3-15.288l-189.91.264c-8.433.012-15.3 6.885-15.3 15.318v21.31c.001 8.427 6.855 15.281 15.276 15.281z"></path><path d="M58.667 517.854c.073 29.26.073 29.449 3.072 29.449h.055l10.612.294h.086s85.814 0 171.629-.036c42.914-.019 85.821-.05 118-.092 16.09-.019 29.505-.043 38.887-.074 17.803-.055 17.803-.055 17.803-3.072l.3-10.697V333.299c0-8.434-6.866-15.3-15.3-15.3h-11.909c-8.434 0-15.3 6.866-15.3 15.3V496.22c0 5.062-4.119 9.18-9.181 9.18H110.51c-5.061 0-9.18-4.118-9.18-9.18V333.299c0-8.434-6.867-15.3-15.3-15.3H73.82c-8.433 0-15.3 6.86-15.3 15.3 0 23.342.012 76.084.055 122.981.019 23.447.05 45.442.092 61.574z"></path><path d="M142.322 397.399l189.402 17.467c.478.043.948.062 1.413.062 7.956 0 14.468-5.985 15.159-13.917l1.83-21.096c.729-8.396-5.508-15.851-13.898-16.628l-189.102-17.461c-8.593-.795-15.869 5.441-16.653 13.825l-1.97 21.108a15.172 15.172 0 0 0 3.452 11.181 15.19 15.19 0 0 0 10.367 5.459zM437.636 208.849a15.253 15.253 0 0 0 17.694 12.443l21.065-3.678c8.311-1.451 13.898-9.395 12.454-17.706l-32.504-187.23c-1.42-8.207-9.21-13.917-17.692-12.448l-21.065 3.678c-8.311 1.451-13.898 9.395-12.454 17.705l32.502 187.236zM190.333 194.375l163.6 96.708a15.28 15.28 0 0 0 7.778 2.136c5.393 0 10.447-2.876 13.183-7.509l10.876-18.36c2.08-3.519 2.674-7.631 1.658-11.591a15.18 15.18 0 0 0-7.032-9.358l-163.6-96.714c-7.014-4.149-16.836-1.597-20.967 5.374l-10.869 18.36a15.2 15.2 0 0 0-1.658 11.591 15.21 15.21 0 0 0 7.031 9.363zM387.525 240.501a15.276 15.276 0 0 0 12.626 6.659c3.091 0 6.077-.924 8.635-2.681l17.405-11.934c6.953-4.768 8.752-14.314 4.015-21.292L323.29 54.104c-4.584-6.732-14.498-8.623-21.236-3.984l-17.737 12.21c-6.945 4.779-8.727 14.327-3.971 21.291l107.179 156.88zM154.482 302.319l183.465 49.156c1.298.349 2.632.526 3.966.526 6.903 0 12.98-4.67 14.762-11.347l5.508-20.624c2.179-8.152-2.681-16.555-10.826-18.74l-183.465-49.162c-8.017-2.148-16.604 2.852-18.728 10.826l-5.508 20.63c-2.179 8.142 2.68 16.551 10.826 18.735z"></path></svg>Stack Overflow</a></li>
</ul>
</div>
<div class="subscribe">
<a href="https://share.hsforms.com/1e2W03wLJQQKPd1d9rCbj_Q2npzm"><button class="btn btn-subscribe f-tc">Subscribe to Blog</button></a>
</div>
</div>
</div>
<div class="container copyright-container">
<p class="copyright">© 2020 PingCAP. All Rights Reserved.</p>
<a class="copyright-btn-lang" href="/blog-cn" id="lang">中文</a>
</div>
</footer>
<button class="back-to-top" type="button"><svg height="512" viewbox="0 0 284.929 284.929" width="512" xmlns="http://www.w3.org/2000/svg"><path d="M282.082 195.285L149.028 62.24c-1.901-1.903-4.088-2.856-6.562-2.856s-4.665.953-6.567 2.856L2.856 195.285C.95 197.191 0 199.378 0 201.853c0 2.474.953 4.664 2.856 6.566l14.272 14.271c1.903 1.903 4.093 2.854 6.567 2.854s4.664-.951 6.567-2.854l112.204-112.202 112.208 112.209c1.902 1.903 4.093 2.848 6.563 2.848 2.478 0 4.668-.951 6.57-2.848l14.274-14.277c1.902-1.902 2.847-4.093 2.847-6.566.001-2.476-.944-4.666-2.846-6.569z" fill="#FFF"></path></svg>
</button>
</div><div class="overlay"></div><script src="https://download.pingcap.com/js/jquery.min.js"></script><script src="/js/vendor/lazyload.min.js" type="text/javascript"></script>
<script src="/js/doc.js" type="text/javascript"></script>
<script src="/js/anchor.js" type="text/javascript"></script><script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script crossorigin="anonymous" integrity="sha384-jbFinqIbKkHNg+QL+yxB4VrBC0EAPTuaLGeRT0T+NfEV89YC6u1bKxHLwoo+/xxY" src="https://browser.sentry-cdn.com/5.11.0/bundle.min.js"></script><script>Sentry.init({ 
            dsn: 'https://3f28ed393c5545daa74496b3cdb2e9ba@sentry.io/1887163' 
        });</script></body></html>